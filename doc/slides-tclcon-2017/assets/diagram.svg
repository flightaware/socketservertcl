<?xml version="1.0" encoding="utf-8" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN" "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd"><svg xmlns="http://www.w3.org/2000/svg" width="1162" height="785" xmlns:xlink="http://www.w3.org/1999/xlink"><source><![CDATA[participant client
participant OS
participant socketservertcl\nserver as S
participant FIFO
participant socketservertcl\nclient as C
participant application
Note over S,C: fork() new client process
Note over application: register\nsocketservertcl\ncallback
client-->>OS: TCP Open
OS->S: accept()\nget new FD
Note over client,S: TCP session established
S->FIFO: sendmsg(FD,SCM_RIGHTS)
FIFO-->>C: TCL FD Event
FIFO->C: recvmsg(FD,SCM_RIGHTS)
C->application: handle_listen(\nsock,ip,port)
client->application: ""HELO""
application->client: ""OK""
Note right of application: close()\nre-register\ncallback proc
]]></source><desc></desc><defs><marker viewBox="0 0 5 5" markerWidth="5" markerHeight="5" orient="auto" refX="5" refY="2.5" id="markerArrowBlock"><path d="M 0 0 L 5 2.5 L 0 5 z"></path></marker><marker viewBox="0 0 9.6 16" markerWidth="4" markerHeight="16" orient="auto" refX="9.6" refY="8" id="markerArrowOpen"><path d="M 9.6,8 1.92,16 0,13.7 5.76,8 0,2.286 1.92,0 9.6,8 z"></path></marker></defs><g class="title"></g><g class="actor"><rect x="10" y="20" width="77.609375" height="57.203125" stroke="#000000" fill="#ffffff" style="stroke-width: 2px;"></rect><text x="20" y="54.1171875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="20">client</tspan></text></g><g class="actor"><rect x="10" y="708.421875" width="77.609375" height="57.203125" stroke="#000000" fill="#ffffff" style="stroke-width: 2px;"></rect><text x="20" y="742.5390625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="20">client</tspan></text></g><line x1="48.8046875" x2="48.8046875" y1="77.203125" y2="708.421875" stroke="#000000" fill="none" style="stroke-width: 2px;"></line><g class="actor"><rect x="126.015625" y="20" width="39.203125" height="57.203125" stroke="#000000" fill="#ffffff" style="stroke-width: 2px;"></rect><text x="136.015625" y="54.1171875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="136.015625">OS</tspan></text></g><g class="actor"><rect x="126.015625" y="708.421875" width="39.203125" height="57.203125" stroke="#000000" fill="#ffffff" style="stroke-width: 2px;"></rect><text x="136.015625" y="742.5390625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="136.015625">OS</tspan></text></g><line x1="145.6171875" x2="145.6171875" y1="77.203125" y2="708.421875" stroke="#000000" fill="none" style="stroke-width: 2px;"></line><g class="actor"><rect x="185.21875" y="20" width="164.03125" height="57.203125" stroke="#000000" fill="#ffffff" style="stroke-width: 2px;"></rect><text x="195.21875" y="44.515625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="195.21875">socketservertcl</tspan><tspan dy="1.2em" x="195.21875">server</tspan></text></g><g class="actor"><rect x="185.21875" y="708.421875" width="164.03125" height="57.203125" stroke="#000000" fill="#ffffff" style="stroke-width: 2px;"></rect><text x="195.21875" y="732.9375" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="195.21875">socketservertcl</tspan><tspan dy="1.2em" x="195.21875">server</tspan></text></g><line x1="267.234375" x2="267.234375" y1="77.203125" y2="708.421875" stroke="#000000" fill="none" style="stroke-width: 2px;"></line><g class="actor"><rect x="469.265625" y="20" width="58.40625" height="57.203125" stroke="#000000" fill="#ffffff" style="stroke-width: 2px;"></rect><text x="479.265625" y="54.1171875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="479.265625">FIFO</tspan></text></g><g class="actor"><rect x="469.265625" y="708.421875" width="58.40625" height="57.203125" stroke="#000000" fill="#ffffff" style="stroke-width: 2px;"></rect><text x="479.265625" y="742.5390625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="479.265625">FIFO</tspan></text></g><line x1="498.46875" x2="498.46875" y1="77.203125" y2="708.421875" stroke="#000000" fill="none" style="stroke-width: 2px;"></line><g class="actor"><rect x="647.6875" y="20" width="164.03125" height="57.203125" stroke="#000000" fill="#ffffff" style="stroke-width: 2px;"></rect><text x="657.6875" y="44.515625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="657.6875">socketservertcl</tspan><tspan dy="1.2em" x="657.6875">client</tspan></text></g><g class="actor"><rect x="647.6875" y="708.421875" width="164.03125" height="57.203125" stroke="#000000" fill="#ffffff" style="stroke-width: 2px;"></rect><text x="657.6875" y="732.9375" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="657.6875">socketservertcl</tspan><tspan dy="1.2em" x="657.6875">client</tspan></text></g><line x1="729.703125" x2="729.703125" y1="77.203125" y2="708.421875" stroke="#000000" fill="none" style="stroke-width: 2px;"></line><g class="actor"><rect x="831.71875" y="20" width="125.625" height="57.203125" stroke="#000000" fill="#ffffff" style="stroke-width: 2px;"></rect><text x="841.71875" y="54.1171875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="841.71875">application</tspan></text></g><g class="actor"><rect x="831.71875" y="708.421875" width="125.625" height="57.203125" stroke="#000000" fill="#ffffff" style="stroke-width: 2px;"></rect><text x="841.71875" y="742.5390625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="841.71875">application</tspan></text></g><line x1="894.53125" x2="894.53125" y1="77.203125" y2="708.421875" stroke="#000000" fill="none" style="stroke-width: 2px;"></line><g class="note"><rect x="257.234375" y="97.203125" width="482.46875" height="28" stroke="#000000" fill="#ffffff" style="stroke-width: 2px;"></rect><text x="262.234375" y="116.71875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="262.234375">fork() new client process</tspan></text></g><g class="note"><rect x="817.515625" y="145.203125" width="154.03125" height="66.40625" stroke="#000000" fill="#ffffff" style="stroke-width: 2px;"></rect><text x="822.515625" y="164.71875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="822.515625">register</tspan><tspan dy="1.2em" x="822.515625">socketservertcl</tspan><tspan dy="1.2em" x="822.515625">callback</tspan></text></g><g class="signal"><text x="58.8046875" y="242.125" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="58.8046875">TCP Open</tspan></text><line x1="48.8046875" x2="145.6171875" y1="249.609375" y2="249.609375" stroke="#000000" fill="none" style="stroke-width: 2px; stroke-dasharray: 6px, 2px; marker-end: url(#markerArrowOpen);"></line></g><g class="signal"><text x="158.41796875" y="270.5234375" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="158.41796875">accept()</tspan><tspan dy="1.2em" x="158.41796875">get new FD</tspan></text><line x1="145.6171875" x2="267.234375" y1="306.8125" y2="306.8125" stroke="#000000" fill="none" style="stroke-width: 2px; marker-end: url(#markerArrowBlock);"></line></g><g class="note"><rect x="38.8046875" y="326.8125" width="238.4296875" height="28" stroke="#000000" fill="#ffffff" style="stroke-width: 2px;"></rect><text x="43.8046875" y="346.328125" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="43.8046875">TCP session established</tspan></text></g><g class="signal"><text x="277.234375" y="385.328125" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="277.234375">sendmsg(FD,SCM_RIGHTS)</tspan></text><line x1="267.234375" x2="498.46875" y1="392.8125" y2="392.8125" stroke="#000000" fill="none" style="stroke-width: 2px; marker-end: url(#markerArrowBlock);"></line></g><g class="signal"><text x="556.4765625" y="423.328125" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="556.4765625">TCL FD Event</tspan></text><line x1="498.46875" x2="729.703125" y1="430.8125" y2="430.8125" stroke="#000000" fill="none" style="stroke-width: 2px; stroke-dasharray: 6px, 2px; marker-end: url(#markerArrowOpen);"></line></g><g class="signal"><text x="508.46875" y="461.328125" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="508.46875">recvmsg(FD,SCM_RIGHTS)</tspan></text><line x1="498.46875" x2="729.703125" y1="468.8125" y2="468.8125" stroke="#000000" fill="none" style="stroke-width: 2px; marker-end: url(#markerArrowBlock);"></line></g><g class="signal"><text x="744.90625" y="489.7265625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="744.90625">handle_listen(</tspan><tspan dy="1.2em" x="744.90625">sock,ip,port)</tspan></text><line x1="729.703125" x2="894.53125" y1="526.015625" y2="526.015625" stroke="#000000" fill="none" style="stroke-width: 2px; marker-end: url(#markerArrowBlock);"></line></g><g class="signal"><text x="442.86328125" y="556.53125" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="442.86328125">"HELO"</tspan></text><line x1="48.8046875" x2="894.53125" y1="564.015625" y2="564.015625" stroke="#000000" fill="none" style="stroke-width: 2px; marker-end: url(#markerArrowBlock);"></line></g><g class="signal"><text x="452.46484375" y="594.53125" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="452.46484375">"OK"</tspan></text><line x1="894.53125" x2="48.8046875" y1="602.015625" y2="602.015625" stroke="#000000" fill="none" style="stroke-width: 2px; marker-end: url(#markerArrowBlock);"></line></g><g class="note"><rect x="914.53125" y="622.015625" width="134.828125" height="66.40625" stroke="#000000" fill="#ffffff" style="stroke-width: 2px;"></rect><text x="919.53125" y="641.53125" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="919.53125">close()</tspan><tspan dy="1.2em" x="919.53125">re-register</tspan><tspan dy="1.2em" x="919.53125">callback proc</tspan></text></g></svg>